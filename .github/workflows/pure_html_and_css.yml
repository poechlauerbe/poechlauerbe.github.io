name: Static Website CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          npm install -g htmlhint stylelint stylelint-config-standard lighthouse
          sudo apt install chromium-browser

      - name: Install LinkChecker
        run: sudo apt-get install linkchecker

      - name: Install http-server
          sudo apt install http-server
        continue-on-error: true

      - name: Validate HTML
        run: htmlhint '**/*.html'
        continue-on-error: true

      - name: Lint CSS
        run: |
          echo "module.exports = { extends: 'stylelint-config-standard' };" > .stylelintrc.js
          stylelint '**/*.css'
        continue-on-error: true

      - name: Check for broken links
        run: linkchecker ./index.html
        continue-on-error: true

      # - name: Start local server
      #   run: |
      #     http-server -p 8080 &
      #     sleep 5 # wait for server to start

      - name: Run accessibility tests (Lighthouse)
        run: lighthouse http://localhost:8080 --output json --output html --output-path ./lighthouse
        continue-on-error: true

      - name: Serve files for Lighthouse
        run: |
          sudo npm install -g http-server
          http-server -p 8080 &
        continue-on-error: true

      - name: Run performance tests (Lighthouse)
        run: lighthouse http://localhost:8080 --output json --output html --output-path ./lighthouse
        continue-on-error: true
